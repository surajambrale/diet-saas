<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - Diet Subscription</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>My Dashboard</h1>
  <div id="userInfo"></div>
  <div id="dietPlan"></div>
  <button onclick="logout()">Logout</button>

  <script>
    const email = localStorage.getItem("email");
    const plan = localStorage.getItem("selectedPlan");

    if (!email) {
      alert("Please login first");
      window.location.href = "login.html";
    }

    async function loadDashboard() {
      try {
        const res = await fetch("http://localhost:5000/check-subscription", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, plan })
        });

        const data = await res.json();

        if (data.active) {
          document.getElementById("userInfo").innerHTML =
            `<h2>Welcome, ${email}</h2>
             <p>Plan: ${plan}</p>
             <p>Valid till: ${new Date(data.expiry).toDateString()}</p>`;

          // Show diet plan based on subscription
          let diet = "";
          if (plan === "Weight Loss (1500 Cal)") {
            diet = `
              <h3>1500 Calorie Weight Loss Plan</h3>
              <ul>
                <li>Breakfast: Oats + Egg whites</li>
                <li>Lunch: Brown rice + Chicken + Veggies</li>
                <li>Dinner: Salad + Paneer</li>
              </ul>`;
          } else if (plan === "Muscle Gain (2000 Cal)") {
            diet = `
              <h3>2000 Calorie Muscle Gain Plan</h3>
              <ul>
                <li>Breakfast: 4 Whole Eggs + Oats</li>
                <li>Lunch: Rice + Chicken + Veggies</li>
                <li>Dinner: Roti + Paneer/Chicken</li>
              </ul>`;
          } else {
            diet = `
              <h3>General Fitness Plan</h3>
              <ul>
                <li>Breakfast: Fruits + Milk</li>
                <li>Lunch: Roti + Sabzi + Dal</li>
                <li>Dinner: Light Salad + Soup</li>
              </ul>`;
          }

          document.getElementById("dietPlan").innerHTML = diet;
        } else {
          document.getElementById("userInfo").innerHTML =
            `<h2>Welcome, ${email}</h2>
             <p>Your subscription has expired.</p>
             <a href="index.html">Renew Plan</a>`;
        }
      } catch (err) {
        console.error("Dashboard Error:", err);
      }
    }

    function logout() {
      localStorage.clear();
      window.location.href = "login.html";
    }

    loadDashboard();
  </script>
</body>
</html>
